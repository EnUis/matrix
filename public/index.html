<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FACEIT Leaderboard</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#060812;
      --bg1:#0b1020;
      --card: rgba(255,255,255,0.055);
      --card2: rgba(255,255,255,0.035);
      --stroke: rgba(255,255,255,0.11);
      --stroke2: rgba(255,255,255,0.08);
      --muted: rgba(255,255,255,0.70);

      --accent: #00ff99;
      --accent2:#00c8ff;
      --glow: rgba(0,255,153,0.18);
      --glow2: rgba(0,200,255,0.14);

      --gold:#ffd700;
      --silver:#cfd6e6;
      --bronze:#d99a5d;

      --shadow: 0 18px 65px rgba(0,0,0,0.55);
      --shadow2: 0 12px 45px rgba(0,0,0,0.45);

      --radius: 18px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:'Orbitron', sans-serif;
      color:#fff;
      background:
        radial-gradient(900px 500px at 18% -12%, rgba(0,255,153,0.13), transparent 60%),
        radial-gradient(900px 500px at 82% -12%, rgba(0,200,255,0.11), transparent 62%),
        radial-gradient(900px 450px at 50% 115%, rgba(255,215,0,0.08), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
      overflow-x:hidden;
    }

    /* subtle moving light */
    body::before{
      content:"";
      position:fixed;
      inset:-20%;
      background:
        radial-gradient(600px 250px at 15% 15%, rgba(0,255,153,0.12), transparent 55%),
        radial-gradient(600px 250px at 85% 10%, rgba(0,200,255,0.10), transparent 55%);
      filter: blur(18px);
      opacity:0.75;
      animation: floatGlow 8s ease-in-out infinite alternate;
      pointer-events:none;
    }
    @keyframes floatGlow{
      from{ transform: translate3d(-1.5%, -1%, 0) scale(1.02); }
      to  { transform: translate3d( 1.5%,  1%, 0) scale(1.04); }
    }

    /* HEADER */
    .site-header{
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(12px);
      background: rgba(0,0,0,0.36);
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }
    .header-inner{
      width: min(1180px, 94vw);
      margin: 0 auto;
      padding: 14px 0;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 14px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap: 12px;
      min-width:0;
    }
    .site-logo{
      width: 46px;
      height: 46px;
      border-radius: 14px;
      object-fit: cover;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: 0 0 20px rgba(0,255,153,0.10);
    }
    .site-title{
      font-weight:800;
      letter-spacing:1px;
      color: var(--accent);
      text-shadow: 0 0 18px rgba(0,255,153,0.24);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .header-actions{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.10);
      color: var(--muted);
      font-size:12px;
      user-select:none;
    }
    .btn{
      font-family:inherit;
      font-weight:800;
      letter-spacing:0.6px;
      cursor:pointer;
      border-radius:14px;
      padding:10px 12px;
      color:#fff;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      transition: transform .06s ease, box-shadow .25s ease, border-color .25s ease;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    .btn:hover{
      border-color: rgba(0,255,153,0.45);
      box-shadow: 0 0 18px var(--glow);
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      background: linear-gradient(180deg, rgba(0,255,153,0.18), rgba(0,255,153,0.08));
      border-color: rgba(0,255,153,0.45);
    }
    .btn.ghost:hover{
      border-color: rgba(0,200,255,0.45);
      box-shadow: 0 0 18px var(--glow2);
    }

    /* MAIN */
    .container{
      width: min(1180px, 94vw);
      margin: 26px auto 80px;
      position:relative;
      z-index: 1;
    }

    .topline{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
      margin: 18px 0 12px;
    }
    h1{
      margin:0;
      font-size: 30px;
      letter-spacing: 1px;
      text-transform: uppercase;
    }
    .status{
      margin:0;
      color: var(--muted);
      font-size: 12px;
    }

    /* CONTROLS */
    .controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin: 10px 0 14px;
    }
    .control-left, .control-right{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .input{
      background: rgba(0,0,0,0.28);
      border: 1px solid rgba(255,255,255,0.12);
      color:#fff;
      padding: 11px 12px;
      border-radius: 14px;
      outline:none;
      width: min(360px, 92vw);
      font-family:inherit;
    }
    .input:focus{
      border-color: rgba(0,255,153,0.45);
      box-shadow: 0 0 0 3px rgba(0,255,153,0.10);
    }
    .select{
      appearance:none;
      background: rgba(0,0,0,0.28);
      border: 1px solid rgba(255,255,255,0.12);
      color:#fff;
      padding: 11px 12px;
      border-radius: 14px;
      outline:none;
      font-family:inherit;
      font-weight:800;
      letter-spacing:0.4px;
      cursor:pointer;
    }

    /* PODIUM TOP 3 */
    .podium{
      display:grid;
      grid-template-columns: 1fr 1.12fr 1fr;
      gap:14px;
      margin: 10px 0 16px;
    }
    @media (max-width: 920px){
      .podium{ grid-template-columns: 1fr; }
    }

    .pod-card{
      position:relative;
      border-radius: var(--radius);
      padding: 16px;
      background: linear-gradient(180deg, var(--card), rgba(0,0,0,0.22));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow2);
      overflow:hidden;
    }
    .pod-card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(620px 220px at 20% 0%, rgba(0,255,153,0.14), transparent 60%),
        radial-gradient(620px 220px at 80% 0%, rgba(0,200,255,0.12), transparent 60%);
      opacity:0.9;
      pointer-events:none;
    }
    .pod-card > *{ position:relative; z-index:1; }

    .pod-card.champ{
      border-color: rgba(255,215,0,0.22);
      box-shadow: var(--shadow), 0 0 28px rgba(255,215,0,0.10);
      transform: scale(1.03);
    }
    @media (max-width: 920px){
      .pod-card.champ{ transform:none; }
    }

    .pod-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:12px;
      color: var(--muted);
      font-size:12px;
    }
    .rankTag{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.22);
      font-weight:800;
      letter-spacing:1px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    .rankTag.gold{ color: var(--gold); border-color: rgba(255,215,0,0.35); }
    .rankTag.silver{ color: var(--silver); border-color: rgba(207,214,230,0.30); }
    .rankTag.bronze{ color: var(--bronze); border-color: rgba(217,154,93,0.35); }

    .pod-player{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:0;
    }

    .ring{
      width: 56px;
      height: 56px;
      border-radius: 999px;
      padding: 2px;
      background: conic-gradient(from 90deg, rgba(0,255,153,0.0), rgba(0,255,153,0.75), rgba(0,200,255,0.55), rgba(0,255,153,0.0));
      box-shadow: 0 0 20px rgba(0,255,153,0.10);
      flex: 0 0 auto;
    }
    .ring.gold{
      background: conic-gradient(from 90deg, rgba(255,215,0,0.0), rgba(255,215,0,0.75), rgba(0,255,153,0.35), rgba(255,215,0,0.0));
      box-shadow: 0 0 22px rgba(255,215,0,0.10);
    }
    .av{
      width: 52px;
      height: 52px;
      border-radius: 999px;
      object-fit:cover;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      display:block;
    }

    .pname{
      font-weight:800;
      letter-spacing:0.6px;
      font-size:18px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 440px;
    }
    .pmeta{
      margin-top:6px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      color: var(--muted);
      font-size:12px;
    }
    .badge{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
      user-select:none;
    }

    /* TABLE CARD */
    .table-card{
      border-radius: var(--radius);
      overflow:hidden;
      border: 1px solid var(--stroke2);
      background: rgba(255,255,255,0.035);
      box-shadow: var(--shadow);
    }
    table{
      width:100%;
      border-collapse:collapse;
    }
    thead{
      background: rgba(0,0,0,0.30);
    }
    thead th{
      font-size:12px;
      letter-spacing:1px;
      text-transform:uppercase;
      color: var(--muted);
      padding: 14px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      text-align:left;
    }
    tbody td{
      padding: 12px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      font-size: 14px;
    }
    tbody tr{
      transition: background .2s ease;
    }
    tbody tr:hover{
      background: rgba(0,255,153,0.05);
    }

    .playerCell{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .miniRing{
      width: 38px;
      height: 38px;
      border-radius: 999px;
      padding: 1.5px;
      background: conic-gradient(from 90deg, rgba(0,255,153,0.0), rgba(0,255,153,0.55), rgba(0,200,255,0.45), rgba(0,255,153,0.0));
      flex: 0 0 auto;
    }
    .miniAv{
      width: 35px;
      height: 35px;
      border-radius: 999px;
      object-fit:cover;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      display:block;
    }
    .nameSmall{
      font-weight:800;
      letter-spacing:0.4px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 520px;
    }

    .right{ text-align:right; }

    /* SKELETON */
    .skel{
      position:relative;
      overflow:hidden;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.08);
    }
    .skel::after{
      content:"";
      position:absolute;
      inset:0;
      transform: translateX(-120%);
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.10), transparent);
      animation: shimmer 1.2s infinite;
    }
    @keyframes shimmer{
      100%{ transform: translateX(120%); }
    }

    .pod-skel-line{ height:14px; border-radius:999px; }
    .pod-skel-name{ height:16px; border-radius:999px; width: 70%; }
    .pod-skel-badge{ height:12px; border-radius:999px; width: 40%; }

    .empty{
      padding: 18px;
      color: var(--muted);
      font-size: 12px;
    }
  </style>
</head>

<body>
<header class="site-header" aria-label="Site header">
  <div class="header-inner">
    <div class="brand">
      <img src="logo.png" alt="Site logo" class="site-logo" />
      <div class="site-title">FACEIT ELO</div>
    </div>

    <div class="header-actions">
      <div id="lastUpdate" class="pill">Last update: --</div>
      <a class="btn ghost" href="/admin.html" title="Admin Panel">ADMIN</a>
      <button class="btn primary" id="refreshBtn" type="button">REFRESH</button>
    </div>
  </div>
</header>

<div class="container">
  <div class="topline">
    <h1>MATRIX LEADERBOARD</h1>
    <p id="status" class="status">Loading...</p>
  </div>

  <div class="controls">
    <div class="control-left">
      <input id="search" class="input" placeholder="Search player..." />
    </div>
    <div class="control-right">
      <div class="pill">Sort</div>
      <select id="sort" class="select">
        <option value="elo">ELO</option>
        <option value="level">LEVEL</option>
        <option value="name">NAME</option>
      </select>
    </div>
  </div>

  <div id="podium" class="podium" aria-hidden="true"></div>

  <div class="table-card">
    <table>
      <thead>
        <tr>
          <th style="width:70px;">#</th>
          <th>PLAYER</th>
          <th class="right" style="width:120px;">LEVEL</th>
          <th class="right" style="width:140px;">ELO</th>
        </tr>
      </thead>
      <tbody id="board"></tbody>
    </table>
    <div id="emptyState" class="empty" style="display:none;"></div>
  </div>
</div>

<script type="module">
  const statusEl = document.getElementById("status");
  const podiumEl = document.getElementById("podium");
  const boardEl = document.getElementById("board");
  const lastUpdateEl = document.getElementById("lastUpdate");
  const refreshBtn = document.getElementById("refreshBtn");
  const searchEl = document.getElementById("search");
  const sortEl = document.getElementById("sort");
  const emptyEl = document.getElementById("emptyState");

  let allPlayers = [];
  let viewPlayers = [];

  function safeAvatar(url){
    return url && String(url).trim().length ? url : "https://via.placeholder.com/64";
  }

  function medalClass(i){
    if(i === 0) return "gold";
    if(i === 1) return "silver";
    if(i === 2) return "bronze";
    return "";
  }

  function setLastUpdate(){
    const d = new Date();
    lastUpdateEl.textContent = "Last update: " + d.toLocaleString();
  }

  function setLoadingUI(){
    statusEl.textContent = "Loading...";
    podiumEl.setAttribute("aria-hidden","false");
    podiumEl.innerHTML = `
      <div class="pod-card">
        <div class="pod-head">
          <span class="rankTag gold">#1</span>
          <span class="skel pod-skel-line" style="width:80px;"></span>
        </div>
        <div class="pod-player">
          <div class="ring gold"><div class="av skel"></div></div>
          <div style="min-width:0; flex:1;">
            <div class="skel pod-skel-name"></div>
            <div class="pmeta">
              <span class="skel pod-skel-badge"></span>
              <span class="skel pod-skel-badge" style="width:55%;"></span>
            </div>
          </div>
        </div>
      </div>
      <div class="pod-card">
        <div class="pod-head">
          <span class="rankTag silver">#2</span>
          <span class="skel pod-skel-line" style="width:80px;"></span>
        </div>
        <div class="pod-player">
          <div class="ring"><div class="av skel"></div></div>
          <div style="min-width:0; flex:1;">
            <div class="skel pod-skel-name"></div>
            <div class="pmeta">
              <span class="skel pod-skel-badge"></span>
              <span class="skel pod-skel-badge" style="width:55%;"></span>
            </div>
          </div>
        </div>
      </div>
      <div class="pod-card">
        <div class="pod-head">
          <span class="rankTag bronze">#3</span>
          <span class="skel pod-skel-line" style="width:80px;"></span>
        </div>
        <div class="pod-player">
          <div class="ring"><div class="av skel"></div></div>
          <div style="min-width:0; flex:1;">
            <div class="skel pod-skel-name"></div>
            <div class="pmeta">
              <span class="skel pod-skel-badge"></span>
              <span class="skel pod-skel-badge" style="width:55%;"></span>
            </div>
          </div>
        </div>
      </div>
    `;

    boardEl.innerHTML = "";
    emptyEl.style.display = "none";
  }

  function applyFilterAndSort(){
    const q = searchEl.value.trim().toLowerCase();
    viewPlayers = allPlayers.filter(p => (p.nickname || "").toLowerCase().includes(q));

    const mode = sortEl.value;
    if(mode === "elo"){
      viewPlayers.sort((a,b) => (b.elo ?? -1) - (a.elo ?? -1));
    }else if(mode === "level"){
      viewPlayers.sort((a,b) => (b.level ?? -1) - (a.level ?? -1));
    }else{
      viewPlayers.sort((a,b) => String(a.nickname||"").localeCompare(String(b.nickname||"")));
    }

    render();
  }

  function render(){
    if(!Array.isArray(viewPlayers) || viewPlayers.length === 0){
      podiumEl.setAttribute("aria-hidden","true");
      podiumEl.innerHTML = "";
      boardEl.innerHTML = "";
      emptyEl.style.display = "block";
      emptyEl.textContent = allPlayers.length === 0
        ? "No players yet. Add players in Admin Panel."
        : "No players match your search.";
      return;
    }

    emptyEl.style.display = "none";

    // Top 3 podium (show best center visually)
    const top = viewPlayers.slice(0,3);
    const order = [1,0,2].filter(i => top[i]);

    podiumEl.setAttribute("aria-hidden", top.length < 3 ? "true" : "false");
    podiumEl.innerHTML = "";
    if(top.length >= 3){
      order.forEach((idx) => {
        const p = top[idx];
        const rank = idx + 1;
        const isChamp = rank === 1;

        const card = document.createElement("div");
        card.className = "pod-card" + (isChamp ? " champ" : "");
        const ringCls = isChamp ? "ring gold" : "ring";

        card.innerHTML = `
          <div class="pod-head">
            <span class="rankTag ${medalClass(idx)}">#${rank} ${isChamp ? "CHAMPION" : rank===2 ? "RUNNER-UP" : "TOP 3"}</span>
            <span>${p.elo} ELO</span>
          </div>

          <div class="pod-player">
            <div class="${ringCls}">
              <img class="av" src="${safeAvatar(p.avatar)}" alt="">
            </div>
            <div style="min-width:0;">
              <div class="pname" title="${p.nickname}">${p.nickname}</div>
              <div class="pmeta">
                <span class="badge">LVL ${p.level}</span>
                <span class="badge">ID-SAFE</span>
              </div>
            </div>
          </div>
        `;
        podiumEl.appendChild(card);
      });
    } else {
      podiumEl.setAttribute("aria-hidden","true");
      podiumEl.innerHTML = "";
    }

    // Table (rank 4+)
    boardEl.innerHTML = "";
    viewPlayers.slice(3).forEach((p, i) => {
      const rank = i + 4;
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${rank}</td>
        <td>
          <div class="playerCell">
            <div class="miniRing">
              <img class="miniAv" src="${safeAvatar(p.avatar)}" alt="">
            </div>
            <div class="nameSmall" title="${p.nickname}">${p.nickname}</div>
          </div>
        </td>
        <td class="right">${p.level}</td>
        <td class="right">${p.elo}</td>
      `;
      boardEl.appendChild(tr);
    });
  }

  async function loadLeaderboard(){
    try{
      setLoadingUI();
      const res = await fetch("/leaderboard", { cache: "no-store" });
      if(!res.ok) throw new Error("HTTP " + res.status);

      const data = await res.json();
      allPlayers = Array.isArray(data) ? data : [];

      statusEl.textContent = "Live (auto refresh 60s)";
      setLastUpdate();

      applyFilterAndSort();
    }catch(e){
      console.error(e);
      statusEl.textContent = "Error loading leaderboard.";
      podiumEl.setAttribute("aria-hidden","true");
      podiumEl.innerHTML = "";
      boardEl.innerHTML = "";
      emptyEl.style.display = "block";
      emptyEl.textContent = "Could not load leaderboard. Check server and API keys.";
    }
  }

  refreshBtn.addEventListener("click", loadLeaderboard);
  searchEl.addEventListener("input", applyFilterAndSort);
  sortEl.addEventListener("change", applyFilterAndSort);

  loadLeaderboard();
  setInterval(loadLeaderboard, 60000);
</script>

</body>
</html>
