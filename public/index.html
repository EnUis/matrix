<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FACEIT Leaderboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#05070b;
      --bg2:#070b14;
      --card: rgba(255,255,255,0.05);
      --stroke: rgba(255,255,255,0.09);
      --muted: rgba(255,255,255,0.70);
      --accent: #00ff99;
      --accent2:#00c8ff;
      --gold:#ffd700;
      --silver:#cfd6e6;
      --bronze:#d99a5d;
      --shadow: 0 18px 60px rgba(0,0,0,0.55);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:'Orbitron', sans-serif;
      color:#fff;
      background:
        radial-gradient(900px 480px at 20% -10%, rgba(0,255,153,0.16), transparent 60%),
        radial-gradient(900px 480px at 80% -10%, rgba(0,200,255,0.12), transparent 60%),
        radial-gradient(700px 420px at 50% 110%, rgba(255,215,0,0.10), transparent 60%),
        linear-gradient(180deg, var(--bg2), var(--bg1));
      overflow-x:hidden;
    }

    /* subtle animated scan lines */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      background: repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,0.025),
        rgba(255,255,255,0.025) 1px,
        transparent 1px,
        transparent 5px
      );
      opacity:0.35;
      mix-blend-mode: overlay;
    }

    /* header */
    .site-header{
      position:sticky;
      top:0;
      z-index:10;
      backdrop-filter: blur(10px);
      background: rgba(0,0,0,0.35);
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }
    .header-inner{
      width:min(1100px, 94vw);
      margin:0 auto;
      padding:14px 0;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:0;
    }
    .site-logo{
      width:44px;
      height:44px;
      border-radius:12px;
      object-fit:cover;
      background: rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.12);
      box-shadow: 0 0 22px rgba(0,255,153,0.12);
    }
    .site-title{
      font-weight:800;
      letter-spacing:1px;
      color: var(--accent);
      text-shadow: 0 0 18px rgba(0,255,153,0.25);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .header-actions{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.10);
      color: var(--muted);
      font-size:12px;
    }
    .btn{
      font-family:inherit;
      font-weight:800;
      letter-spacing:0.6px;
      cursor:pointer;
      border-radius:12px;
      padding:10px 12px;
      color:#fff;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      transition: transform .06s ease, box-shadow .25s ease, border-color .25s ease;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .btn:hover{
      border-color: rgba(0,255,153,0.45);
      box-shadow: 0 0 18px rgba(0,255,153,0.18);
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      background: linear-gradient(180deg, rgba(0,255,153,0.20), rgba(0,255,153,0.08));
      border-color: rgba(0,255,153,0.45);
    }

    /* main */
    .container{
      width:min(1100px, 94vw);
      margin: 26px auto 70px;
    }

    .headline{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
      margin-top:18px;
    }
    h1{
      margin:0;
      font-size:30px;
      letter-spacing:1px;
      text-transform:uppercase;
    }
    .status{
      margin:0;
      color: var(--muted);
      font-size:12px;
    }

    /* top 3 */
    .top-three{
      display:grid;
      grid-template-columns: 1fr 1.1fr 1fr;
      gap:14px;
      margin: 18px 0 18px;
    }
    @media (max-width: 900px){
      .top-three{ grid-template-columns: 1fr; }
    }
    .top-card{
      position:relative;
      border-radius:18px;
      overflow:hidden;
      padding:18px;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0.25));
      border: 1px solid rgba(255,255,255,0.10);
      box-shadow: var(--shadow);
      transform: translateZ(0);
    }
    .top-card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background: radial-gradient(600px 200px at 20% 0%, rgba(0,255,153,0.22), transparent 60%),
                  radial-gradient(600px 200px at 80% 0%, rgba(0,200,255,0.18), transparent 60%);
      opacity:0.9;
      pointer-events:none;
    }
    .top-card.best{
      border-color: rgba(255,215,0,0.35);
      box-shadow: 0 18px 70px rgba(0,0,0,0.55), 0 0 40px rgba(255,215,0,0.12);
      transform: scale(1.04);
    }
    @media (max-width: 900px){ .top-card.best{ transform:none; } }

    .top-inner{ position:relative; z-index:1; display:flex; flex-direction:column; gap:10px; }

    .medal{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-size:12px;
      color: var(--muted);
    }
    .rankTag{
      font-weight:800;
      letter-spacing:1px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.25);
    }
    .rankTag.gold{ border-color: rgba(255,215,0,0.35); color: var(--gold); }
    .rankTag.silver{ border-color: rgba(207,214,230,0.35); color: var(--silver); }
    .rankTag.bronze{ border-color: rgba(217,154,93,0.40); color: var(--bronze); }

    .topPlayer{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:0;
    }
    .avatar{
      width:54px;
      height:54px;
      border-radius:999px;
      object-fit:cover;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      box-shadow: 0 0 26px rgba(0,255,153,0.14);
      flex: 0 0 auto;
    }
    .name{
      font-size:18px;
      font-weight:800;
      letter-spacing:0.6px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .submeta{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:6px;
      color: var(--muted);
      font-size:12px;
    }
    .badge{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
    }

    /* table */
    .card{
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.04);
      box-shadow: var(--shadow);
    }
    table{
      width:100%;
      border-collapse:collapse;
    }
    thead{
      background: rgba(0,0,0,0.35);
    }
    thead th{
      font-size:12px;
      letter-spacing:1px;
      text-transform:uppercase;
      color: var(--muted);
      padding:14px 12px;
      border-bottom:1px solid rgba(255,255,255,0.08);
      text-align:left;
    }
    tbody td{
      padding:12px 12px;
      border-bottom:1px solid rgba(255,255,255,0.06);
      font-size:14px;
    }
    tbody tr{
      transition: background .2s ease, transform .06s ease;
    }
    tbody tr:hover{
      background: rgba(0,255,153,0.06);
    }

    .playerCell{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .playerCell .name{
      font-size:14px;
      font-weight:800;
    }

    .miniAv{
      width:36px;
      height:36px;
      border-radius:999px;
      object-fit:cover;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      flex: 0 0 auto;
    }

    .right{
      text-align:right;
    }
  </style>
</head>

<body>
<header class="site-header" aria-label="Site header">
  <div class="header-inner">
    <div class="brand">
      <img src="logo.png" alt="Site logo" class="site-logo" />
      <div class="site-title">FACEIT ELO</div>
    </div>

    <div class="header-actions">
      <div id="lastUpdate" class="pill">Last update: --</div>
      <a class="btn" href="/admin.html" title="Admin Panel">ADMIN</a>
      <button class="btn primary" id="refreshBtn">REFRESH</button>
    </div>
  </div>
</header>

<div class="container">
  <div class="headline">
    <h1>MATRIX LEADERBOARD</h1>
    <p id="status" class="status">Loading...</p>
  </div>

  <div id="topThree" class="top-three" aria-hidden="true"></div>

  <div class="card">
    <table>
      <thead>
        <tr>
          <th style="width:70px;">#</th>
          <th>PLAYER</th>
          <th style="width:120px;" class="right">LEVEL</th>
          <th style="width:140px;" class="right">ELO</th>
        </tr>
      </thead>
      <tbody id="board"></tbody>
    </table>
  </div>
</div>

<script type="module">
  const statusEl = document.getElementById("status");
  const topThreeEl = document.getElementById("topThree");
  const boardEl = document.getElementById("board");
  const lastUpdateEl = document.getElementById("lastUpdate");
  const refreshBtn = document.getElementById("refreshBtn");

  function safeAvatar(url){
    return url && url.trim().length ? url : "https://via.placeholder.com/64";
  }

  function medalClass(i){
    if(i === 0) return "gold";
    if(i === 1) return "silver";
    if(i === 2) return "bronze";
    return "";
  }

  function setLastUpdate(){
    const d = new Date();
    lastUpdateEl.textContent = "Last update: " + d.toLocaleString();
  }

  function renderTopThree(players){
    topThreeEl.innerHTML = "";

    if(players.length < 3){
      topThreeEl.setAttribute("aria-hidden", "true");
      return;
    }

    const order = [1,0,2]; // show best in center visually
    order.forEach((idx, cardPos) => {
      const p = players[idx];
      const rank = idx + 1;

      const card = document.createElement("div");
      card.className = "top-card" + (rank === 1 ? " best" : "");

      card.innerHTML = `
        <div class="top-inner">
          <div class="medal">
            <span class="rankTag ${medalClass(idx)}">#${rank} ${rank===1?"CHAMPION":rank===2?"RUNNER-UP":"TOP 3"}</span>
            <span>${p.elo} ELO</span>
          </div>

          <div class="topPlayer">
            <img class="avatar" src="${safeAvatar(p.avatar)}" alt="">
            <div style="min-width:0;">
              <div class="name">${p.nickname}</div>
              <div class="submeta">
                <span class="badge">LVL ${p.level}</span>
                <span class="badge">ID-SAFE</span>
              </div>
            </div>
          </div>
        </div>
      `;

      topThreeEl.appendChild(card);
    });

    topThreeEl.setAttribute("aria-hidden", "false");
  }

  function renderTable(players){
    boardEl.innerHTML = "";

    players.slice(3).forEach((p, i) => {
      const rank = i + 4;
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${rank}</td>
        <td>
          <div class="playerCell">
            <img class="miniAv" src="${safeAvatar(p.avatar)}" alt="">
            <div class="name" title="${p.nickname}">${p.nickname}</div>
          </div>
        </td>
        <td class="right">${p.level}</td>
        <td class="right">${p.elo}</td>
      `;
      boardEl.appendChild(tr);
    });
  }

  async function load(){
    try{
      statusEl.textContent = "Loading...";
      const res = await fetch("/leaderboard", { cache: "no-store" });
      if(!res.ok) throw new Error("HTTP " + res.status);

      const players = await res.json();

      if(!Array.isArray(players) || players.length === 0){
        statusEl.textContent = "No players yet. Add players in Admin.";
        topThreeEl.innerHTML = "";
        boardEl.innerHTML = "";
        return;
      }

      statusEl.textContent = "Live (Auto refresh every 60s)";
      renderTopThree(players);
      renderTable(players);
      setLastUpdate();
    }catch(e){
      statusEl.textContent = "Error loading leaderboard.";
      console.error(e);
    }
  }

  refreshBtn.addEventListener("click", load);
  load();
  setInterval(load, 60000);
</script>

</body>
</html>
