<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MATRIX Leaderboard</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&display=swap" rel="stylesheet">

  <!-- ✅ NEW esports stylesheet -->
  <link rel="stylesheet" href="leaderboard.css">
</head>

<body>

<header class="site-header">
  <div class="header-inner">
    <div class="brand">
      <img src="logo.png" class="logo" alt="Logo">
      <div class="titleWrap">
        <div class="site-title">MATRIX FACEIT ELO</div>
        <div class="subtitle">LIVE LEADERBOARD • ID SAFE</div>
      </div>
    </div>

    <div class="header-actions">
      <div id="lastUpdate" class="pill">Last update: --</div>
      <a class="btn ghost" href="/admin.html">ADMIN</a>
      <button class="btn primary" id="refreshBtn">REFRESH</button>
    </div>
  </div>
</header>

<div class="container">
  <div class="topline">
    <h1>LEADERBOARD</h1>
    <p id="status" class="status">Loading...</p>
  </div>

  <div class="controls">
    <input id="search" class="input" placeholder="Search player...">
    <select id="sort" class="select">
      <option value="elo">ELO</option>
      <option value="level">LEVEL</option>
      <option value="name">NAME</option>
    </select>
  </div>

  <div id="podium" class="podium"></div>

  <div class="table-card">
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>PLAYER</th>
          <th class="right">LEVEL</th>
          <th class="right">ELO</th>
        </tr>
      </thead>
      <tbody id="board"></tbody>
    </table>
    <div id="emptyState" class="empty"></div>
  </div>
</div>

<script type="module">
  const board = document.getElementById("board");
  const podium = document.getElementById("podium");
  const status = document.getElementById("status");
  const lastUpdate = document.getElementById("lastUpdate");
  const search = document.getElementById("search");
  const sort = document.getElementById("sort");
  const empty = document.getElementById("emptyState");

  let all = [];

  const avatar = a => a || "https://via.placeholder.com/64";

  function updateTime(){
    lastUpdate.textContent = "Last update: " + new Date().toLocaleString();
  }

  function render(){
    let list = [...all];
    const q = search.value.toLowerCase();
    list = list.filter(p => p.nickname.toLowerCase().includes(q));

    if(sort.value === "elo") list.sort((a,b)=>b.elo-a.elo);
    if(sort.value === "level") list.sort((a,b)=>b.level-a.level);
    if(sort.value === "name") list.sort((a,b)=>a.nickname.localeCompare(b.nickname));

    board.innerHTML = "";
    podium.innerHTML = "";

    if(list.length === 0){
      empty.textContent = "No players found.";
      return;
    }

    // TOP 3
    list.slice(0,3).forEach((p,i)=>{
      podium.innerHTML += `
        <div class="pod-card ${i===0?'champ':''}">
          <div class="pod-head">#${i+1} <span>${p.elo} ELO</span></div>
          <div class="pod-player">
            <img src="${avatar(p.avatar)}">
            <div>
              <div class="pname">${p.nickname}</div>
              <div class="pmeta">LVL ${p.level}</div>
            </div>
          </div>
        </div>
      `;
    });

    // TABLE
    list.slice(3).forEach((p,i)=>{
      board.innerHTML += `
        <tr>
          <td>${i+4}</td>
          <td class="playerCell">
            <img src="${avatar(p.avatar)}">
            ${p.nickname}
          </td>
          <td class="right">${p.level}</td>
          <td class="right">${p.elo}</td>
        </tr>
      `;
    });
  }

  async function load(){
    status.textContent = "Loading...";
    const res = await fetch("/leaderboard");
    all = await res.json();
    status.textContent = "LIVE";
    updateTime();
    render();
  }

  search.oninput = render;
  sort.onchange = render;
  document.getElementById("refreshBtn").onclick = load;

  load();
  setInterval(load, 60000);
</script>

</body>
</html>